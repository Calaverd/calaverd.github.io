extends ../../componentes/post_layout.pug
block prepend head
  - title    = "Haciendo un blog solo con Plug y Parcel"
  - subtitle = "(y como no morir en el intento)"
  - lang     = "es"
  - type     = 'post'
  - tags     = ["javascript","pug", "parcel"]
  - key      = "202305_pug_and_parcel"
  - status   = "draft"
block append meta
  meta( property="og:image"     content="https://calaverd.github.io/rsc/pug_and_parcel/happy_pug.jpg" )
block encabezado
  img( src="../../rsc/pug_and_parcel/happy_pug.jpg" alt="A happy pug in a box. (Generated by Dall-e Mini)" )
block append content
  h3 ¿Porqué estamos haciendo esto?
  p Jekyll es un generador de sitios estáticos y viene como la herramienta predeterminada de github pages. 
  p Lamentablemente, Jekyll carece por defecto de la capacidad de empaquetar el contenido. Jekyll no "minificara" nuestro html, ni purgara el css, y es incapaz de aplicarle "three shaking" al javascript. Si bien, existen algunos plugins que cubren estas funciones, no es tan terso como me gustaria.
  p Pero somos programadores, y por definición nos gusta hacernos la vida miserable.
  h3 Parcel y Pug
  p Escoger el empaquetador me decidí por Parcel, por tener una mayor experiencia usándolo.
  p El problema principal era sustituir las templates de Jekyll, ya que su mayor beneficio es poder separar nuestro html en partes, dejando nuestro código más DRY.
  p No tenia mucho tiempo para buscar una alternativa, así que mire lo que estaba más a la mano. Para mi buena suerte, entre la lista de lenguajes soportados por parcel estaba lo justo lo que necesitaba: Pug.
  h3 Pug en Parcel. Baches en el camino y como taparlos.
  h4 No hay rutas absolutas, solo relativas.
  //- TODO| contar como pug tiene problemas en parcel js para identificar los recuros porque todo los imports tienen que ser relativos
  //- TODO| y nuesto ingeniosa solucion de solo abusar de las templates condicionales para decirle donde esta.
  h4 Creando listas de post o ¿Como hacemos que un sitio estático parezca dinámico?
  p Los post en mi blog están en dos idiomas y cada post a su vez contiene diferentes tags con categorías. Si queremos crear listas con el contenido, nos encontramos ante el problema de tener que generar una pagina por cada tag en cada idioma, todas las permutaciones posibles, de las cuales se crean algunas que *puede* que nadie jamás vea. Lamentablemente, por estar alojado en GitHub pages, carecemos de un bakend que pueda generar las listas sobre la marcha.
  p Ante esta encrucijada, la respuesta esta en tomar nota de las SPA y procesar esas demandas del lado del cliente. Para hacerlo, requerimos de generar un catalogo de los datos relevantes de nuestros post, abusar del `localStorage` y convertir la pagina 404 en nuestro router.
  p Al generar el catalogo primero hay que crear un script que lea todos los archivos de nuestra carpeta post, y parsear sus datos a un json para guardarlos en lo que sera nuestro **catalogo**. Podemos aprovechar este momento, para agregar otras funciones que nos simplifiquen el trabajo con los datos, como mover en automatico los archivos de los borradores cuando se publican a la carpeta de post #[a.cite#q1(href="#nt1") 1] (y encargarse de componer los links internos), remplazar el markdown de los parrafos por etiquetas de pug, agregar las fechas y un poco de metadata para permitir la navegación entre lenguajes.
  //- TODO incluir aquí un link a los datos de nuestro archivo de processado.
  .notes Notas 
  .footnote#nt1
    a(href="#q1") [1] 
    | Puesto que el script crean y borran archivos, este debe de ser ejecutado **antes** de que inicie el servidor de parcel para prevenir una crisis ontologica. Es decir, que no pueda encontrar los archivos borrados aun que tenga registro de que existen.